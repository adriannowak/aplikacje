---
title: SQL
layout: post
---

### Materiały
 - [TODO]()


# Import/Export danych do bazy MySQL

Zapisywanie kopii bazy danych:

 - `mysqldump.exe -u root -p -x -r DANE.SQL BAZA`
 
Przywracanie kopii:
 - logujemy sie na mysql i wykonujemy `CREATE DATABASE BAZA`
 - `mysql -u root -p BAZA < DANE.SQL`
 

Zadanie 1

Przywróć bazę danych - baza firma
https://gist.github.com/adriannowak/fe91b9d3e93b0ba0d92edb230cb67431

Zadanie 2

Wprowadz dane 3 osob:
```
    8, James, NULL, Wilsom, M, 1987-03-19, 1000, 3, 2013-10-09, 2014-03-01, 1
    9, Robert, NULL, Anderson, M, 1989-12-13, 2900, 2, 2013-12-20, 2014-05-05, 0
    10, John, Mark, Smith, M, 1990-05-24, 2500, 1, 2014-01-24, NULL, 1
```

## Naprawa bazy danych

Polecenie `mysqlcheck.exe NAZWA_BAZY`
 
 -- optimize
 
 -- repair
 
 -- check
 
 
## Polecenia administratora
```
CREATE USER 'ezn_select'@'localhost' IDENTIFIED BY 'ezn123';
```

```
GRANT SELECT ON ezn_123.* TO 'ezn_select'@'localhost';
```

## Polecenie SELECT
 
  - SELECT [*, column, DISTINCT column]
  - FROM
  - WHERE
  - Kolumny wyliczeniowe
  
Operatory porównania =, >, <, >=, <=, !=, <>, is [true,false,null], BETWEEN (liczby, daty), IN (liczby, tekst)
LIKE (%, _), DISTINCT,

```
SELECT * FROM employee;
SELECT FirstName, LastName FROM employee;

SELECT * FROM employee WHERE Salary >= 2500;

SELECT * FROM employee WHERE DepartmentId = 3
SELECT * FROM employee WHERE (Salary = 1000 OR Salary = 2000) AND DepartmentId = 4;
SELECT * FROM employee WHERE Active != 1; -- IS FALSE
SELECT *, Salary + 100 as "Pencja po podwyzce" FROM employee;
SELECT *, Salary * 1.1 as "po podwyzce" from employee;
SELECT FirstName, Salary*1.1 From employee WHERE Salary*1.1 >= 2500;
SELECT * FROM employee WHERE Gender = 'W' AND BirthDate >= '1990-01-01' AND Salary <= 2000;

SELECT * FROM employee WHERE Gender = 'M' AND Salary >1000 AND Salary < 2000;

SELECT * FROM employee WHERE Gender = 'M' AND Salary BETWEEN 1000 AND 2000;
SELECT * FROM employee WHERE HireDate BETWEEN '2012-01-01' AND '2013-12-30';

SELECT * FROM employee WHERE Salary < 1000 OR Salary > 2000;

SELECT * FROM employee WHERE Salary NOT BETWEEN 1000 AND 2000

SELECT * FROM employee WHERE Id = 1 OR Id = 2 OR Id = 3;
SELECT * FROM employee WHERE Id BETWEEN 1 AND 3;
SELECT * FROM employee WHERE Id IN (1,2,3);

SELECT * FROM employee WHERE Id <> 1 AND Id <> 2 AND Id <> 3;
SELECT * FROM employee WHERE Id NOT BETWEEN 1 AND 3;
SELECT * FROM employee WHERE Id NOT IN (1,2,3);

SELECT * FROM employee WHERE FirstName = 'John' and Salary > 1500;



SELECT * FROM employee WHERE FirstName = 'John' OR FistName = 'Linda';
SELECT * FROM employee WHERE FirstName IN ('John','Linda');

SELECT * FROM employee WHERE FirstName LIKE 'J%';
SELECT * FROM employee WHERE FirstName LIKE  '_a%';

SELECT * FROM employee ORDER BY LastName, FirstName

SELECT * FROM employee ORDER BY LastName DESC, FirstName DESC

SELECT * FROM employee ORDER BY Salary DESC;

SELECT * FROM employee ORDER BY Salary DESC LIMIT 3
```


## Zadania 

https://gist.github.com/adriannowak/89d54173ee0d49e69ce76a5af342f217


1. Znajdź dane wszystkich firm, których nazwa (kolumna Name ) rozpoczyna się od litery „P”.

2. Znajdź dane wszystkich firm, które znajdują się w mieście (kolumna CityId ) o identyfi katorze równym 1 i których kod pocztowy (kolumna PostCode ) rozpoczyna się cyfrą 5.

3. Znajdź wszystkie firmy, które zostały założone w 2000 roku. Załóż, że w kolumnie. StartDate jest przechowywana data bez godziny, i rozwiąż zadanie na dwa sposoby.

4. Dla aktywnych firm (kolumna Active ), zatrudniających więcej niż 1000 pracowników (kolumna EmployeeCount), wyświetl: nazwę, przychód roczny (kolumna AnnualIncome ) oraz przychód miesięczny

5. Wyświetl nazwę oraz przychód miesięczny dla trzech firm mających najwyższy spośród wszystkich przychód miesięczny

6. Znajdź firmy, których miesięczny przychód jest większy niż 10000 zł.

7. Znajdź dane tych firm, których kod pocztowy to: 54-621, 78-695 lub 63-896. Dla tych firm wyświetl: nazwę, kod pocztowy oraz ulicę (kolumna Street ) i numer (kolumna Number ). Ulicę i numer wyświetl w jednej kolumnie. Zadanie rozwiąż na dwa sposoby.

8. Dla danych wszystkich firm wyświetl: nazwę oraz ulicę i numer. Ulicę i numer wyświetl w jednej kolumnie. Dla firm, dla których nie zdefiniowano ulicy, zamiast ulicy wyświetl tekst „ulica nieznana” .

9. Wyświetl wszystkie firmy, które mają siedzibę w mieście o identyfikatorze różnym niż 1 , 3 i 5 . Zadanie rozwiąż na dwa sposoby.

10. Wyświetl dane wszystkich aktywnych firm, które nie mają podanej daty rozpoczęcia działalności.

11. Wyświetl wszystkie firmy, których nazwa spełnia następujące warunki:
 - pierwsza litera to „C”, „P” lub „T”,
 - ostatnia litera to „O” lub „R”

12. Wyświetl wszystkie firmy, których nazwa spełnia następujące warunki:
 - druga litera to „O”,
 - ostatnia litera jest różna od „E”

13. Wyświetl trzy firmy, które były najwcześniej założone

14. Dla każdej aktywnej firmy, która zatrudnia mniej niż 1000 osób, wyświetl: nazwę firmy, liczbę zatrudnionych oraz liczbę osób, której brakuje do tego, by firma zatrudniała 1000 osób

15. Dla wszystkich aktywnych firm wyświetl nazwę firmy oraz kwotę, którą dostałby każdy pracownik, gdyby rozdzielić 
zatrudnionym po równo cały roczny przychód.

16. Wyświetl nazwy firm, w których roczny przychód przypadający na pracownika (z po-
przedniego zadania) jest większy niż 300 zł.

17. Wyświetl firmę o największym rocznym przychodzie na pracownika.

18. Wyświetl wszystkie aktywne firmy, które mają siedzibę w mieście o identyfikatorze (kolumna CityId ) równym 1 lub 2 , oraz o liczbie pracowników mniejszej niż 500 lub większej niż 1500.

19. Wyświetl wszystkie unikalne nazwy ulic.

20. Dla wszystkich firm, które mają zdefiniowane miasto, w którym się znajdują, wyświetl: nazwę firmy, identyfikator miasta, roczny przychód oraz liczbę zatrudnionych pracowników. Wyniki uporządkuj według identyfikatora miasta (kolumna CityId ). Firmy o takim samym identyfikatorze miasta uporządkuj malejąco według rocznego przychodu. Firmy o takim samym rocznym przychodzie uporządkuj malejąco według liczby pracowników.

21. Wyświetl wszystkie aktywne firmy, które nie nazywają się Casio ani Yamaha. Zadanie rozwiąż na dwa sposoby



## Złączenia INNER JOIN, LEFT JOIN, RIGHT JOIN, CROSS JOIN

[Baza danych](https://gist.github.com/adriannowak/64b0c2c26f9fcc1e9848ca0806c685f2)

Ćwiczenia: 
[Baza danych](https://gist.github.com/adriannowak/7d356054cfcb2c5805bb68dbb55f655b)


[Test](https://sqlzoo.net/wiki/JOIN_Quiz)

## Zadania

[Baza danych](https://gist.github.com/adriannowak/abe59162892458071981528b1fa50ab7)


1. Wyświetl numery ( OrderNumber ) i daty ( OrderDate ) zamówień (z tabeli Orders ) złożonych
przez pracownika o nazwisku Brown.

2. Wyświetl numery i daty zamówień złożonych przez pracownika Browna w roku 2015.

3. Wyświetl, jakie towary (z tabeli Product ) i w jakiej liczbie (kolumna Qunatity w tabeli
OrderDetails ) zostały zamówione w zamówieniu o numerze Z/25/2015 .

4. Wyświetl nazwy i liczbę towarów, które zostały zamówione w lutym 2015 roku.

5. Wyświetl wszystkie towary należące do kategorii Drive (z tabeli ProductCategory ).

6. Wyświetl wszystkie towary należące do tych kategorii, których nazwa kończy się na literę „y”.

7. Wyświetl wszystkie towary, które w swojej nazwie zawierają nazwę kategorii, do której należą.

8. Wyświetl nazwy i liczbę produktów, które zostały zamówione w ostatnim miesiącu.

9. Wyświetl nazwy grup produktów, do których nie ma przypisanych żadnych produktów.

10. Wyświetl nazwy produktów, które nigdy nie były zamawiane.

11. Wyświetl imię i nazwisko pracownika oraz kwotę zamówienia — dla pracownika, który złożył zamówienie o najwyższej wartości (kolumna OrderTotal z tabeli Orders ).

12. Dla każdego zamówienia wypisz numer zamówienia, datę zamówienia, nazwę dnia tygodnia, w którym to zamówienia zostało złożone, i kod pracownika, składający się trzech pierwszych liter imienia i z trzech pierwszych liter nazwiska, pisany wielkimi literami. Wyniki ogranicz tylko do zamówień, złożonych przez pracowników działu IT; posortuj wyświetlone dane według daty zamówienia.

13. Sprawdź, czy istnieją zamówienia, które nie mają żadnej pozycji zamówienia (tabelaOrderDetails ). Wyświetl dla tych zamówień numer i datę zamówienia.

14. Wyświetl wszystkie towary, które widniały na zamówieniach złożonych przez pracowników, którzy nie mają drugiego imienia. Każdy towar powinien się pojawić w wynikach tylko jeden raz.

15. Znajdź zamówienia, których wartość ( OrderTotal ) jest taka sama, jak zarobki pracownika, który złożył to zamówienie. Wyświetl imię i nazwisko pracownika, jego zarobki oraz wartość zamówienia.

16. Znajdź pozycje zamówienia, w których zamówiono taką liczbę towarów, ile lat ma pracownik, który je złożył. Wyświetl nazwę i liczbę towaru, imię i nazwisko oraz wiek pracownika.

17. Znajdź pozycje zamówienia, w których zamówiona liczba towarów jest taka sama, jak numer miesiąca, w którym zostało złożone zamówienie. Wyświetl liczbę, imię i nazwisko pracownika oraz numer miesiąca.

18. Znajdź wszystkie towary, które zostały sprzedane po cenie (kolumna UnitCost z tabeli OrderDetails ) niższej niż cena sugerowana dla danego produktu (kolumna Price z tabeli product ). Wyświetl nazwę i sugerowaną cenę produktu oraz cenę sprzedaży




## Zadania

1. Policz wszystkie towary z tabeli Product.

2. Policz wszystkie towary, których sugerowana cena (kolumna Price ) jest niższa niż 100 zł.

3. Policz wszystkie zamówienia (tabela Orders ) złożone w 2015 roku (kolumna OrderDate ).

4. Znajdź średnią oraz najniższą i najwyższą sugerowaną cenę spośród wszystkich towarów.

5. Wyświetl średnią cenę produktów z kategorii Drive .

6. Wyświetl łączną sumę wartości wszystkich zamówień złożonych w lutym 2015 roku.

7. Policz sumę wartości zamówień wystawionych przez kobiety.

8. Wyświetl nazwy wszystkich grup produktów oraz liczbę produktów znajdujących się w danej grupie.

9. Dla każdego pracownika wyświetl sumę wartości złożonych przez niego zamówień. W wynikach nie uwzględniaj pracowników, którzy nie złożyli żadnego zamówienia.

10. Wyświetl imię i nazwisko pracownika oraz sumę złożonych przez niego zamówień w 2015 roku. Wyniki ogranicz tylko do tych pracowników, dla których ta suma zamówień wynosi pomiędzy 2000 zł i 3000 zł.

11. Dla każdego towaru wyświetl łączną liczbę tych z nich, które zostały zamówione.

12. Dla każdego produktu, który był kiedykolwiek zamówiony, wyświetl datę, kiedy stało się to po raz pierwszy.

13. Dla każdego produktu policz, ile razy został zamówiony w 2015 roku.

14. Dla każdego produktu policz, ile sztuk zostało zamówionych w 2015 roku. Wyniki ogranicz tylko do tych produktów, których zamówiono łącznie mniej niż 10.

15. Dla każdego zamówienia wyświetl liczbę pozycji tego zamówienia.

16. Dla każdego zamówienia wyświetl łączną liczbę zamówionych towarów.

17. Dla każdego zamówienia wyświetl średnią cenę sprzedaży produktów w tym zamówieniu.

18. Wyświetl łączną wartość zamówień w poszczególnych latach.

19. Wyświetl łączną wartość zamówień podzieloną na miesiące.

20. Wyświetl łączną wartość zamówień w poszczególnych latach w podziale na pracowników. Wyniki wyświetl tylko dla aktywnych pracowników



## Zarządzanie dostępem do bazy danych
 
 * CREATE USER 'login'@'hostname' IDENTIFIED BY 'password';
 * DROP USER 'login'@'hostname';
 * GRANT [OPTION] ON [database].[table] TO 'user'@'hostname' 
 * REVOKE 
  - `REVOKE ALL ON baza.tabela FROM [uzytkownik]`

 * SHOW GRANTS FOR 'user'
 * `select host, user, password from mysql.user`

Zmiana hasła dla użytkowników:
 * dla wersji < 5.7.x
   - `SET PASSWORD FOR [user] = PASSWORD('HASLO')`
 * dla nowszych
   - `ALTER USER [user] IDENTIFIED BY 'pass'`

Uwaga: jesli nie podamy hostname to przyjmie domyslna wartosc '%';
 

```sql
CRREATE USER nauczyciel IDENTIFIED BY 'test'
GRANT ALL ON ezn.* TO nauczyciel;
REVOKE ALL ON ezn.* FROM nauczyciel;

SET PASSWORD FOR nauczyciel = PASSWORD('test2');
```


Zadanie egzaminacyjne 1 strona 242

## Widoki
 
 * CREATE VIEW name AS 
 * DROP VIEW name
 * SHOW FULL TABLES
 
Zadanie egzaminacyjne 2 strona 247
[Bada danych](https://gist.github.com/adriannowak/15c4516d5556f0e37c397536db756ace)

 